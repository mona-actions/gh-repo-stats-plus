#!/usr/bin/env bash

set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Change to the extension directory
cd "$SCRIPT_DIR"

# Check if Node.js is available
if ! command -v node >/dev/null 2>&1; then
    echo "Error: Node.js is required but not installed."
    echo "Please install Node.js and try again."
    exit 1
fi

# Check if the bundled script exists
if [ ! -f "$SCRIPT_DIR/dist/index.js" ]; then
    echo "Error: Extension bundle not found at $SCRIPT_DIR/dist/index.js"
    echo "This appears to be a development installation or the extension was not properly built."
    echo ""
    echo "If you're installing from source, please run:"
    echo "  cd $SCRIPT_DIR"
    echo "  npm install"
    echo "  npm run build"
    echo ""
    echo "If you installed via 'gh extension install', please report this as a bug."
    exit 1
fi

# Execute the Node.js script with all arguments passed through
exec node "$SCRIPT_DIR/dist/index.js" "$@"